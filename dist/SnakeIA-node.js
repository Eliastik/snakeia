!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.SnakeIA=e():t.SnakeIA=e()}("undefined"!=typeof self?self:this,(()=>(()=>{var __webpack_modules__={293:function(module){(function(a){var b=Math.sign,c=Math.min,d=Math.abs;void 0===a.Lowlight&&(a.Lowlight={}),"object"==typeof module.exports&&(module.exports=a.Lowlight);class e{constructor(){this.nodes=new Map}id(t){return t}node(t,e=!1){return e?this.nodes.get(this.id(arguments[0])):this.nodes.get(t)}data(t,e){return 2===arguments.length&&(t.graph.get(this)._data=e),t.graph.get(this)._data}adjacent(t,e){return t.graph.get(this).has(e)}neighbors(t){return Array.from(t.graph.get(this).keys())}connected(t,e){return t.graph.get(this)._connectivity===e.graph.get(this)._connectivity}connect(){let t=Array.from(this.nodes.values()),e=0;for(let e=0;e<t.length;e++)t[e].graph.get(this)._connectivity=void 0;for(let i=0;i<t.length;i++){if(void 0!==t[i].graph.get(this)._connectivity)continue;let n=[t[i]];for(e++;n.length;){let t=n.shift();t.graph.get(this)._connectivity=e,this.neighbors(t).map((t=>{void 0===t.graph.get(this)._connectivity&&0>n.indexOf(t)&&n.push(t)}))}}}add(t){return 1<arguments.length?Array.from(arguments).map((t=>this.add(t))):(t.graph.set(this,new Map),this.nodes.set(t.id,t),t)}delete(t){return 1<arguments.length?Array.from(arguments).map((t=>this.delete(t))):(t.graph.delete(this),this.nodes.delete(t.id),t)}edge(t,e,i=1,n=1){if(!t.graph.has(this)||!e.graph.has(this))throw new Error("Nodes must be on the same graph");return null===i?t.graph.get(this).delete(e):t.graph.get(this).set(e,i),null===n?e.graph.get(this).delete(t):e.graph.get(this).set(t,n),this}cost(t,e){return this.adjacent(t,e)?t.graph.get(this).get(e):null}}e.fromArray=function(t,i={}){let n=e.fromArray.X(t,i.order),r=e.fromArray.Y(t,i.order),s=e.fromArray.at.bind(null,t,i.order),o=[],a=null;for(let t,h=1;h<Math.max(2,arguments.length);h++){t=new e,o.push(t),i=arguments[h]||{};let c=e.fromArray.id.bind(null,n,r,i.torus),u=i.cost||e.fromArray.cost,l=e.fromArray.edge.bind(null,t,u);for(let e=0;e<n;e++)for(let i,n=0;n<r;n++)i=t.add(a?a.get(c(e,n)):new f(c(e,n))),i.x=e,i.y=n,i.graph.get(t)._data=s(e,n),l(i,t.nodes.get(c(e-1,n))),l(i,t.nodes.get(c(e+1,n))),l(i,t.nodes.get(c(e,n-1))),l(i,t.nodes.get(c(e,n+1)));if(i.diagonals)for(let e=0;e<n;e++)for(let n=0;n<r;n++){let r=t.nodes.get(c(e,n)),s=t.adjacent(r,t.nodes.get(c(e-1,n))),o=t.adjacent(r,t.nodes.get(c(e+1,n))),a=t.adjacent(r,t.nodes.get(c(e,n-1))),h=t.adjacent(r,t.nodes.get(c(e,n+1)));"strict"===i.cutting?(s&&a&&l(r,t.nodes.get(c(e-1,n-1))),s&&h&&l(r,t.nodes.get(c(e-1,n+1))),o&&a&&l(r,t.nodes.get(c(e+1,n-1))),o&&h&&l(r,t.nodes.get(c(e+1,n+1)))):((s||a||i.cutting)&&l(r,t.nodes.get(c(e-1,n-1))),(s||h||i.cutting)&&l(r,t.nodes.get(c(e-1,n+1))),(o||a||i.cutting)&&l(r,t.nodes.get(c(e+1,n-1))),(o||h||i.cutting)&&l(r,t.nodes.get(c(e+1,n+1))))}Object.defineProperty(t,"id",{enumerable:!1,configurable:!1,writable:!0,value:t=>c(t.x,t.y)}),t.connect(),t.X=n,t.Y=r,t.TORUS=i.torus,a||(a=t.nodes)}return 1<o.length?o:o[0]},e.fromArray.X=function(t,e="yx"){return"xy"===e?t.length:"yx"===e?t[0].length:0},e.fromArray.Y=function(t,e="yx"){return"xy"===e?t[0].length:"yx"===e?t.length:0},e.fromArray.at=function(t,e="yx",i,n){return"xy"===e?t[i][n]:t[n][i]},e.fromArray.id=function(t=0,e=0,i=!1,n,r){return i?(r+e)%e*t+(n+t)%t:0<=n&&n<t&&0<=r&&r<e?r*t+n:null},e.fromArray.cost=function(){return 1},e.fromArray.edge=function(t,e,i,n){n&&t.edge(i,n,e(t.data(i),t.data(n)),e(t.data(n),t.data(i)))},e.fromArray.update=function(){console.warn("Graph.fromArray isn't implemented yet")};class f{constructor(t,e){for(let i in this.id=t,this.graph=new Map,e)"id"!=i&&"graph"!=i&&(this[i]=e[i])}}class g{constructor(t){this.nodes=[],this.score="function"==typeof t?t:t=>+t}get size(){return this.nodes.length}add(t){if(1<arguments.length){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return this.nodes.push(t),this.bubble(this.size-1)}set(t){let e=this.nodes.indexOf(t);return~e?this.score(t)<=this.score(this.nodes[e])?this.bubble(this.nodes.indexOf(t)):this.sink(this.nodes.indexOf(t)):this.add(t)}pop(){let t=this.nodes[0],e=this.nodes.pop();return 0<this.size&&(this.nodes[0]=e,this.sink(0)),t}top(){return this.nodes[0]}delete(t){if(1<arguments.length){for(let t=0;t<arguments.length;t++)this.delete(arguments[t]);return this}for(let e=0;e<this.size;e++){if(this.nodes[e]!=t)continue;let i=this.nodes.pop();return e==this.size-1?this:(this.nodes[e]=i,this.bubble(e).sink(e))}}bubble(t){let e=this.nodes[t],i=this.score(e);for(;0<t;){let n=Math.floor((t+1)/2)-1,r=this.nodes[n];if(i>=this.score(r))break;this.nodes[n]=e,this.nodes[t]=r,t=n}return this}sink(t){let e=this.nodes[t],i=this.score(e);for(;;){let n=2*(t+1),r=n-1,s=null;if(r<this.size&&this.score(this.nodes[r])<i&&(s=r),n<this.size&&this.score(this.nodes[n])<(s?this.score(this.nodes[s]):i)&&(s=n),null===s)break;this.nodes[t]=this.nodes[s],this.nodes[s]=e,t=s}return this}}let h={manhattan:function(t,e,i={}){let n=d(e.x-t.x),r=d(e.y-t.y);return(i.multiplier||1)*(n+r)},manhattanTorus:function(t,e,i={}){let n=c(d(e.x-t.x),e.x+(i.x||0)-t.x,t.x+(i.x||0)-e.x),r=c(d(e.y-t.y),e.y+(i.y||0)-t.y,t.y+(i.y||0)-e.y);return(i.multiplier||1)*(n+r)},diagonal:function(t,e,i={}){let n=d(e.x-t.x),r=d(e.y-t.y);return m*(n+r)+(dm-2*m)*c(n,r)},diagonalTorus:function(t,e,i={}){let n=c(d(e.x-t.x),e.x+(i.x||0)-t.x,t.x+(i.x||0)-e.x),r=c(d(e.y-t.y),e.y+(i.y||0)-t.y,t.y+(i.y||0)-e.y);return(i.multiplier||1)*(n+r)+((i.diagonalMultiplier||1.4)-2*(i.multiplier||1))*c(n,r)},euclidian:function(t,e,i={}){let n=d(e.x-t.x),r=d(e.y-t.y);return(i.multiplier||1)*Math.sqrt(n*n+r*r)},euclidianTorus:function(t,e,i={}){let n=c(d(e.x-t.x),e.x+(i.x||0)-t.x,t.x+(i.x||0)-e.x),r=c(d(e.y-t.y),e.y+(i.y||0)-t.y,t.y+(i.y||0)-e.y);return(i.multiplier||1)*(n+r)+((i.diagonalMultiplier||1.4)-2*(i.multiplier||1))*c(n,r)}};class i extends Error{constructor(t){super(t),this.name="WorkerError"}}class j{constructor(t,n={}){if(this.graphs=[],this.heuristic=n.heuristic||"manhattan",this.heuristicOptions=n.heuristicOptions||{},Array.isArray(t)&&(this.heuristic=n.heuristic in h?n.heuristic:n.diagonals?n.torus?"diagonalTorus":"diagonal":n.torus?"manhattanTorus":"manhattan",this.heuristicOptions.x=e.fromArray.X(t,n.order),this.heuristicOptions.y=e.fromArray.Y(t,n.order),this.graphs=e.fromArray.apply(this,arguments),!Array.isArray(this.graphs)&&(this.graphs=[this.graphs])),n.thread&&("undefined"==typeof WorkerGlobalScope||!(self instanceof WorkerGlobalScope))){this.worker=null;try{this.worker=new Worker(n.thread)}catch(t){throw"file:"===window.location.protocol&&console.warn("WebWorkers in local files may not be supported by your browser."),new i(`${n.thread} couldn't be opened.`)}"cost"in n&&(n.cost=n.cost.toString()),this.worker.postMessage(["constructor",t,n]),this.path=(t,e,i={})=>{this._worker_path_callback=i.callback,delete i.callback,this.worker.postMessage(["path",t,e,i])},this.worker.onmessage=t=>{let e=JSON.parse(t.data);"path"===e[0]&&this._worker_path_callback(e[1])}}}path(t,e,i={}){if(i.jps)return this.jps(t,e,i);let n=new g((t=>t.estimated)),r=new Map,s=this.graphs[i.layer||0];if(t=s.node(t,!0),e=s.node(e,!0),n.add({node:t,estimated:0}),r.set(t,{score:0,from:null}),!i.static||s.connected(t,e))for(;n.size;){let t=n.pop().node;if(t===e)break;s.neighbors(t).map((o=>{let a=(r.has(t)?r.get(t).score:0)+s.cost(t,o);a<(r.has(o)?r.get(o).score:1/0)&&(r.set(o,{score:a,from:t}),n.set({node:o,estimated:a+h[i.heuristic||this.heuristic](o,e,i.heuristicOptions||this.heuristicOptions)}))})),n.delete(t)}let o=[];if(r.has(e)){let t=e;for(o.push(e);null!==(t=r.get(t).from);)o.push(t);o=o.reverse()}return i.callback&&i.callback(o,r),o}}if(j.JPS=class{constructor(){}static access(t,e,i,n){return t.adjacent(e,n?t.node(i,!0):i)}static neighborhood(t,e,i,n){let r=[],s=i.get(n).from||null;if(null===s)return e.neighbors(n);{let i={x:b(n.x-s.x),y:b(n.y-s.y)};if(0!=i.x&&0!=i.y){let s=t(n,{x:n.x+i.x,y:n.y},!0),o=t(n,{x:n.x,y:n.y+i.y},!0);(s||o)&&(r.push(e.node({x:n.x+i.x,y:n.y+i.y},!0)),s&&(r.push(e.node({x:n.x+i.x,y:n.y},!0)),!t(n,{x:n.x,y:n.y-i.y},!0)&&r.push(e.node({x:n.x+i.x,y:n.y-i.y},!0))),o&&(r.push(e.node({x:n.x,y:n.y+i.y},!0)),!t(n,{x:n.x-i.x,y:n.y},!0)&&r.push(e.node({x:n.x-i.x,y:n.y+i.y},!0))))}else t(n,{x:n.x+i.x,y:n.y+i.y},!0)&&(r.push(e.node({x:n.x+i.x,y:n.y+i.y},!0)),0==i.x?0!=i.y&&(!t(n,{x:n.x-1,y:n.y},!0)&&r.push(e.node({x:n.x-1,y:n.y+i.y},!0)),!t(n,{x:n.x+1,y:n.y},!0)&&r.push(e.node({x:n.x+1,y:n.y+i.y},!0))):(!t(n,{x:n.x,y:n.y-1},!0)&&r.push(e.node({x:n.x+i.x,y:n.y-1},!0)),!t(n,{x:n.x,y:n.y+1},!0)&&r.push(e.node({x:n.x+i.x,y:n.y+1},!0))))}return r.filter((t=>t))}static jump(t,e,i,n,r,s){for(;;){if(!t(s,r))return null;if(r.x===n.x&&r.y===n.y)return r;let o={x:b(r.x-s.x),y:b(r.y-s.y)};if(0!=o.x&&0!=o.y){if(!t(r,{x:r.x-o.x,y:r.y},!0)&&t(r,{x:r.x-o.x,y:r.y+o.y},!0)||!t(r,{x:r.x,y:r.y-o.y},!0)&&t(r,{x:r.x+o.x,y:r.y-o.y},!0))return r;let s=j.JPS.jump.bind(this,t,e,i,n);if(null!==s(e.node({x:r.x+o.x,y:r.y},!0),r)||null!==s(e.node({x:r.x,y:r.y+o.y},!0),r))return r}else if(0!=o.x){if(!t(r,{x:r.x,y:r.y-1},!0)&&t(r,{x:r.x+o.x,y:r.y-1},!0)||!t(r,{x:r.x,y:r.y+1},!0)&&t(r,{x:r.x+o.x,y:r.y+1},!0))return r}else if(0!=o.y&&(!t(r,{x:r.x-1,y:r.y},!0)&&t(r,{x:r.x-1,y:r.y+o.y},!0)||!t(r,{x:r.x+1,y:r.y},!0)&&t(r,{x:r.x+1,y:r.y+o.y},!0)))return r;s=r,r=e.node({x:r.x+o.x,y:r.y+o.y},!0)}return null}},j.prototype.jps=function(t,e,i={}){if(this.graphs[i.layer||0].TORUS)return console.warn("Torus map aren't yet supported by JPS"),i.callback&&i.callback([],new Map),[];let n=new g((t=>t.estimated)),r=new Map,s=this.graphs[i.layer||0],o=null;t=s.node(t,!0),e=s.node(e,!0),n.add({node:t,estimated:0}),r.set(t,{score:0,from:null});let a=j.JPS.access.bind(this,s),c=j.JPS.neighborhood.bind(this,a,s,r),u=j.JPS.jump.bind(this,a,s,r,e);if(!i.static||s.connected(t,e))for(;n.size;){let t=n.pop().node;if(t===e)break;c(t).map((a=>{if(null!==(o=u(a,t))){let a=(r.has(t)?r.get(t).score:0)+s.cost(t,o);a<(r.has(o)?r.get(o).score:1/0)&&(r.set(o,{score:a,from:t,jumped:!0}),n.set({node:o,estimated:a+h[i.heuristic||this.heuristic](o,e,i.heuristicOptions||this.heuristicOptions)}))}})),n.delete(t)}let l=[];if(r.has(e)){let i=e;for(;i.x!=t.x||i.y!=t.y;)for(let t=r.get(i).from;i.x!=t.x||i.y!=t.y;)l.push(i),i=s.node({x:i.x+b(t.x-i.x),y:i.y+b(t.y-i.y)},!0);l.push(i),l.reverse()}return i.callback&&i.callback(l,r),l},"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope){let a;onmessage=function(b){let c=b.data;switch(c[0]){case"constructor":if("cost"in c[2]){let a=/^\((.*?)\)\s*=>\s*{/.test(c[2].cost),b=/^function /.test(c[2].cost);c[2].cost=eval(`(${a||b?"":"function "}${c[2].cost})`)}a=new j(c[1],c[2]);break;case"path":postMessage(JSON.stringify(["path",a.path(c[1],c[2],c[3])]))}}}a.Lowlight.Astar={Graph:e,Node:f,BinaryHeap:g,Heuristic:h,Configuration:j,WorkerError:i}})("undefined"==typeof window?this:window)},391:(t,e,i)=>{var n=i(180),r=i(181),s=i(31),o=i(67),a=i(833),h=i(717),c=i(801);c.alea=n,c.xor128=r,c.xorwow=s,c.xorshift7=o,c.xor4096=a,c.tychei=h,t.exports=c},180:function(t,e,i){var n;!function(t,r){function s(t){var e,i=this,n=(e=4022871197,function(t){t=String(t);for(var i=0;i<t.length;i++){var n=.02519603282416938*(e+=t.charCodeAt(i));n-=e=n>>>0,e=(n*=e)>>>0,e+=4294967296*(n-=e)}return 2.3283064365386963e-10*(e>>>0)});i.next=function(){var t=2091639*i.s0+2.3283064365386963e-10*i.c;return i.s0=i.s1,i.s1=i.s2,i.s2=t-(i.c=0|t)},i.c=1,i.s0=n(" "),i.s1=n(" "),i.s2=n(" "),i.s0-=n(t),i.s0<0&&(i.s0+=1),i.s1-=n(t),i.s1<0&&(i.s1+=1),i.s2-=n(t),i.s2<0&&(i.s2+=1),n=null}function o(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function a(t,e){var i=new s(t),n=e&&e.state,r=i.next;return r.int32=function(){return 4294967296*i.next()|0},r.double=function(){return r()+11102230246251565e-32*(2097152*r()|0)},r.quick=r,n&&("object"==typeof n&&o(n,i),r.state=function(){return o(i,{})}),r}r&&r.exports?r.exports=a:i.amdD&&i.amdO?void 0===(n=function(){return a}.call(e,i,e,r))||(r.exports=n):this.alea=a}(0,t=i.nmd(t),i.amdD)},717:function(t,e,i){var n;!function(t,r){function s(t){var e=this,i="";e.next=function(){var t=e.b,i=e.c,n=e.d,r=e.a;return t=t<<25^t>>>7^i,i=i-n|0,n=n<<24^n>>>8^r,r=r-t|0,e.b=t=t<<20^t>>>12^i,e.c=i=i-n|0,e.d=n<<16^i>>>16^r,e.a=r-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):i+=t;for(var n=0;n<i.length+20;n++)e.b^=0|i.charCodeAt(n),e.next()}function o(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function a(t,e){var i=new s(t),n=e&&e.state,r=function(){return(i.next()>>>0)/4294967296};return r.double=function(){do{var t=((i.next()>>>11)+(i.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},r.int32=i.next,r.quick=r,n&&("object"==typeof n&&o(n,i),r.state=function(){return o(i,{})}),r}r&&r.exports?r.exports=a:i.amdD&&i.amdO?void 0===(n=function(){return a}.call(e,i,e,r))||(r.exports=n):this.tychei=a}(0,t=i.nmd(t),i.amdD)},181:function(t,e,i){var n;!function(t,r){function s(t){var e=this,i="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:i+=t;for(var n=0;n<i.length+64;n++)e.x^=0|i.charCodeAt(n),e.next()}function o(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function a(t,e){var i=new s(t),n=e&&e.state,r=function(){return(i.next()>>>0)/4294967296};return r.double=function(){do{var t=((i.next()>>>11)+(i.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},r.int32=i.next,r.quick=r,n&&("object"==typeof n&&o(n,i),r.state=function(){return o(i,{})}),r}r&&r.exports?r.exports=a:i.amdD&&i.amdO?void 0===(n=function(){return a}.call(e,i,e,r))||(r.exports=n):this.xor128=a}(0,t=i.nmd(t),i.amdD)},833:function(t,e,i){var n;!function(t,r){function s(t){var e=this;e.next=function(){var t,i,n=e.w,r=e.X,s=e.i;return e.w=n=n+1640531527|0,i=r[s+34&127],t=r[s=s+1&127],i^=i<<13,t^=t<<17,i^=i>>>15,t^=t>>>12,i=r[s]=i^t,e.i=s,i+(n^n>>>16)|0},function(t,e){var i,n,r,s,o,a=[],h=128;for(e===(0|e)?(n=e,e=null):(e+="\0",n=0,h=Math.max(h,e.length)),r=0,s=-32;s<h;++s)e&&(n^=e.charCodeAt((s+32)%e.length)),0===s&&(o=n),n^=n<<10,n^=n>>>15,n^=n<<4,n^=n>>>13,s>=0&&(o=o+1640531527|0,r=0==(i=a[127&s]^=n+o)?r+1:0);for(r>=128&&(a[127&(e&&e.length||0)]=-1),r=127,s=512;s>0;--s)n=a[r+34&127],i=a[r=r+1&127],n^=n<<13,i^=i<<17,n^=n>>>15,i^=i>>>12,a[r]=n^i;t.w=o,t.X=a,t.i=r}(e,t)}function o(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function a(t,e){null==t&&(t=+new Date);var i=new s(t),n=e&&e.state,r=function(){return(i.next()>>>0)/4294967296};return r.double=function(){do{var t=((i.next()>>>11)+(i.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},r.int32=i.next,r.quick=r,n&&(n.X&&o(n,i),r.state=function(){return o(i,{})}),r}r&&r.exports?r.exports=a:i.amdD&&i.amdO?void 0===(n=function(){return a}.call(e,i,e,r))||(r.exports=n):this.xor4096=a}(0,t=i.nmd(t),i.amdD)},67:function(t,e,i){var n;!function(t,r){function s(t){var e=this;e.next=function(){var t,i,n=e.x,r=e.i;return t=n[r],i=(t^=t>>>7)^t<<24,i^=(t=n[r+1&7])^t>>>10,i^=(t=n[r+3&7])^t>>>3,i^=(t=n[r+4&7])^t<<7,t=n[r+7&7],i^=(t^=t<<13)^t<<9,n[r]=i,e.i=r+1&7,i},function(t,e){var i,n=[];if(e===(0|e))n[0]=e;else for(e=""+e,i=0;i<e.length;++i)n[7&i]=n[7&i]<<15^e.charCodeAt(i)+n[i+1&7]<<13;for(;n.length<8;)n.push(0);for(i=0;i<8&&0===n[i];++i);for(8==i?n[7]=-1:n[i],t.x=n,t.i=0,i=256;i>0;--i)t.next()}(e,t)}function o(t,e){return e.x=t.x.slice(),e.i=t.i,e}function a(t,e){null==t&&(t=+new Date);var i=new s(t),n=e&&e.state,r=function(){return(i.next()>>>0)/4294967296};return r.double=function(){do{var t=((i.next()>>>11)+(i.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},r.int32=i.next,r.quick=r,n&&(n.x&&o(n,i),r.state=function(){return o(i,{})}),r}r&&r.exports?r.exports=a:i.amdD&&i.amdO?void 0===(n=function(){return a}.call(e,i,e,r))||(r.exports=n):this.xorshift7=a}(0,t=i.nmd(t),i.amdD)},31:function(t,e,i){var n;!function(t,r){function s(t){var e=this,i="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:i+=t;for(var n=0;n<i.length+64;n++)e.x^=0|i.charCodeAt(n),n==i.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function o(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function a(t,e){var i=new s(t),n=e&&e.state,r=function(){return(i.next()>>>0)/4294967296};return r.double=function(){do{var t=((i.next()>>>11)+(i.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},r.int32=i.next,r.quick=r,n&&("object"==typeof n&&o(n,i),r.state=function(){return o(i,{})}),r}r&&r.exports?r.exports=a:i.amdD&&i.amdO?void 0===(n=function(){return a}.call(e,i,e,r))||(r.exports=n):this.xorwow=a}(0,t=i.nmd(t),i.amdD)},801:function(t,e,i){var n;!function(r,s,o){var a,h=256,c=o.pow(h,6),u=o.pow(2,52),l=2*u,d=255;function y(t,e,i){var n=[],d=T(p((e=1==e?{entropy:!0}:e||{}).entropy?[t,v(s)]:null==t?function(){try{var t;return a&&(t=a.randomBytes)?t=t(h):(t=new Uint8Array(h),(r.crypto||r.msCrypto).getRandomValues(t)),v(t)}catch(t){var e=r.navigator,i=e&&e.plugins;return[+new Date,r,i,r.screen,v(s)]}}():t,3),n),y=new f(n),x=function(){for(var t=y.g(6),e=c,i=0;t<u;)t=(t+i)*h,e*=h,i=y.g(1);for(;t>=l;)t/=2,e/=2,i>>>=1;return(t+i)/e};return x.int32=function(){return 0|y.g(4)},x.quick=function(){return y.g(4)/4294967296},x.double=x,T(v(y.S),s),(e.pass||i||function(t,e,i,n){return n&&(n.S&&g(n,y),t.state=function(){return g(y,{})}),i?(o.random=t,e):t})(x,d,"global"in e?e.global:this==o,e.state)}function f(t){var e,i=t.length,n=this,r=0,s=n.i=n.j=0,o=n.S=[];for(i||(t=[i++]);r<h;)o[r]=r++;for(r=0;r<h;r++)o[r]=o[s=d&s+t[r%i]+(e=o[r])],o[s]=e;(n.g=function(t){for(var e,i=0,r=n.i,s=n.j,o=n.S;t--;)e=o[r=d&r+1],i=i*h+o[d&(o[r]=o[s=d&s+e])+(o[s]=e)];return n.i=r,n.j=s,i})(h)}function g(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function p(t,e){var i,n=[],r=typeof t;if(e&&"object"==r)for(i in t)try{n.push(p(t[i],e-1))}catch(t){}return n.length?n:"string"==r?t:t+"\0"}function T(t,e){for(var i,n=t+"",r=0;r<n.length;)e[d&r]=d&(i^=19*e[d&r])+n.charCodeAt(r++);return v(e)}function v(t){return String.fromCharCode.apply(0,t)}if(T(o.random(),s),t.exports){t.exports=y;try{a=i(234)}catch(t){}}else void 0===(n=function(){return y}.call(e,i,e,t))||(t.exports=n)}("undefined"!=typeof self?self:this,[],Math)},234:()=>{}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var i=__webpack_module_cache__[t]={id:t,loaded:!1,exports:{}};return __webpack_modules__[t].call(i.exports,i,i.exports,__webpack_require__),i.loaded=!0,i.exports}__webpack_require__.amdD=function(){throw new Error("define cannot be used indirect")},__webpack_require__.amdO={},__webpack_require__.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return __webpack_require__.d(e,{a:e}),e},__webpack_require__.d=(t,e)=>{for(var i in e)__webpack_require__.o(e,i)&&!__webpack_require__.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},__webpack_require__.nmd=t=>(t.paths=[],t.children||(t.children=[]),t);var __webpack_exports__={};return(()=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Event:()=>o,GameConstants:()=>t,GameEngine:()=>b,GameGroup:()=>S,GameUtils:()=>h,Grid:()=>y,Position:()=>c,Reactor:()=>a,Snake:()=>w});const t={CaseType:{EMPTY:0,SNAKE:1,FRUIT:2,WALL:3,SNAKE_DEAD:4,SURROUNDED:5,FRUIT_GOLD:6,CROSSED:7},PlayerType:{AI:"PLAYER_AI",HUMAN:"PLAYER_HUMAN",HYBRID_HUMAN_AI:"PLAYER_HYBRID_HUMAN_AI"},AiLevel:{RANDOM:"AI_LEVEL_RANDOM",LOW:"AI_LEVEL_LOW",DEFAULT:"AI_LEVEL_DEFAULT",HIGH:"AI_LEVEL_HIGH",ULTRA:"AI_LEVEL_ULTRA",CUSTOM:"AI_LEVEL_CUSTOM",MOCK:"AI_LEVEL_MOCK"},OutputType:{TEXT:"OUTPUT_TEXT",GRAPHICAL:"OUTPUT_GRAPHICAL"},Setting:{CANVAS_WIDTH:800,CANVAS_HEIGHT:600,FONT_FAMILY:"Delius",FONT_SIZE:28,HEADER_HEIGHT_DEFAULT:75,TARGET_FPS:60,TIME_MULTIPLIER:15,IMAGE_SNAKE_HUE:75,IMAGE_SNAKE_SATURATION:50,IMAGE_SNAKE_VALUE:77,CARS_TO_PRERENDER:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","Ã—"],APP_VERSION:"2.2",DATE_VERSION:"10/18/2020",PROB_GOLD_FRUIT_1_PLAYER:100,PROB_GOLD_FRUIT_MULTIPLE_PLAYERS:50,INFO_NOTIF_COLOR:"rgba(52, 152, 219, 0.5)",ERROR_NOTIF_COLOR:"rgba(231, 76, 60, 0.5)"},Direction:{UP:0,TOP:0,RIGHT:1,BOTTOM:2,DOWN:2,LEFT:3,ANGLE_1:4,ANGLE_2:5,ANGLE_3:6,ANGLE_4:7},Key:{UP:38,RIGHT:39,BOTTOM:40,LEFT:37,ENTER:13},Error:{ROOM_NOT_FOUND:"ROOM_NOT_FOUND",ROOM_ALREADY_JOINED:"ROOM_ALREADY_JOINED",INVALID_SETTINGS:"INVALID_SETTINGS",MAX_ROOM_LIMIT_REACHED:"MAX_ROOM_LIMIT_REACHED",AUTHENTICATION_REQUIRED:"AUTHENTICATION_REQUIRED",ALREADY_CREATED_ROOM:"ALREADY_CREATED_ROOM",BANNED:"BANNED",DISCONNECTED:"DISCONNECTED"},GameState:{STARTING:"STARTING",STARTED:"STARTED",SEARCHING_PLAYERS:"SEARCHING_PLAYERS",AUTHENTICATION_SUCCESS:"AUTHENTICATION_SUCCESS"}};function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function n(t){var e=function(t){if("object"!=i(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==i(e)?e:e+""}function r(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,n(r.key),r)}}function s(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}var o=function(){return s((function t(i){e(this,t),this.name=i,this.callbacks=[]}),[{key:"registerCallback",value:function(t){this.callbacks.push(t)}}])}(),a=function(){return s((function t(){e(this,t),this.events={}}),[{key:"registerEvent",value:function(t){this.events[t]=new o(t)}},{key:"dispatchEvent",value:function(t,e){for(var i=this.events[t].callbacks,n=0,r=i.length;n<r;n++)i[n](e)}},{key:"addEventListener",value:function(t,e){this.events[t].registerCallback(e)}}])}();const h={randRange:function(t,e,i){return Math.floor((i?i():Math.random())*(e-t+1))+t},addHue:function(t,e){var i=t+e;return i>360?i-360:i<0?360+i:i},shuffle:function(t,e){for(var i,n,r=t.length-1;r>0;r--)i=Math.floor((e?e():Math.random())*(r+1)),n=t[r],t[r]=t[i],t[i]=n;return t},millisecondsFormat:function(t){return t/=1e3,("0"+Math.trunc(t/60)).slice(-2)+":"+("0"+Math.trunc(t%60)).slice(-2)},secondsFormat:function(t){return this.millisecondsFormat(1e3*t)}};var c=function(){function i(t,n,r){e(this,i),this.x=t,this.y=n,this.direction=r}return s(i,[{key:"copy",value:function(){return new i(this.x,this.y,this.direction)}},{key:"convertToKeyDirection",value:function(){switch(this.direction){case t.Direction.UP:return t.Key.UP;case t.Direction.RIGHT:return t.Key.RIGHT;case t.Direction.LEFT:return t.Key.LEFT;case t.Direction.BOTTOM:return t.Key.BOTTOM;default:return this.direction}}},{key:"convertToSimpleDirection",value:function(){switch(this.direction){case t.Key.UP:return t.Direction.UP;case t.Key.RIGHT:return t.Direction.RIGHT;case t.Key.LEFT:return t.Direction.LEFT;case t.Key.BOTTOM:return t.Direction.BOTTOM;default:return this.direction}}},{key:"equals",value:function(t){return null!=t&&this.x==t.x&&this.y==t.y}}])}(),u=__webpack_require__(391),l=__webpack_require__.n(u),d=__webpack_require__(293),y=function(){return s((function i(n,r,s,o,a,h,u,l,d,y){e(this,i),this.width=null==n?20:n,this.height=null==r?20:r,this.generateWalls=null!=s&&s,this.borderWalls=null!=o&&o,this.maze=null!=a&&a,this.mazeFirstPosition=new c(1,1,t.Direction.RIGHT),this.mazeForceAuto=null!=u&&u,this.grid,this.initialGrid,this.fruitPos,this.fruitPosGold,this.customGrid=h,this.seedGrid=l?""+parseInt(l):void 0,this.seedGame=l?""+parseInt(d):void 0,this.rngGrid,this.rngGame,this.probGoldFruitIncrease=null!=y&&y}),[{key:"init",value:function(){if(null!=this.customGrid||null!=this.initialGrid){var e;e=null!=this.initialGrid?this.initialGrid:this.customGrid,this.height=e.length,this.width=e[0].length,this.initialGrid=new Array(this.height),this.grid=new Array(this.height);for(var i=0;i<this.height;i++)this.initialGrid[i]=e[i].slice(),this.grid[i]=e[i].slice()}else{this.grid=new Array(this.height);for(var n=0;n<this.height;n++){this.grid[n]=new Array(this.width);for(var r=0;r<this.width;r++)this.borderWalls&&(0==n||n==this.height-1||0==r||r==this.width-1)||this.generateWalls&&this.rngGrid&&this.rngGrid()>.65||this.maze?this.grid[n][r]=t.CaseType.WALL:this.grid[n][r]=t.CaseType.EMPTY}this.maze?this.generateMaze():this.generateWalls&&this.fixWalls(this.borderWalls)}this.fruitPosGold=null}},{key:"reset",value:function(){this.grid=void 0,this.initialGrid=void 0,this.fruitPos=void 0,this.fruitPosGold=void 0,this.rngGrid=new(l())(this.seedGrid),this.rngGame=new(l())(this.seedGame)}},{key:"fixWalls",value:function(e){var i,n,r,s;e?(i=1,r=this.height-1,n=1,s=this.width-1):(i=0,r=this.height,n=0,s=this.width);for(var o=i;o<r;o++)for(var a=n;a<s;a++){var h=new c(a,o),u=this.getNextPosition(h,t.Direction.UP),l=this.getNextPosition(u,t.Direction.LEFT),d=this.getNextPosition(u,t.Direction.RIGHT),y=this.getNextPosition(h,t.Direction.BOTTOM),f=this.getNextPosition(y,t.Direction.LEFT),g=this.getNextPosition(y,t.Direction.RIGHT);this.get(l)!=t.CaseType.WALL&&this.get(d)!=t.CaseType.WALL&&this.get(f)!=t.CaseType.WALL&&this.get(g)!=t.CaseType.WALL||this.set(t.CaseType.EMPTY,h)}}},{key:"maze_recursion",value:function(e,i){for(var n=h.shuffle([t.Direction.UP,t.Direction.RIGHT,t.Direction.BOTTOM,t.Direction.LEFT],this.rngGrid),r=0;r<n.length;r++)switch(n[r]){case t.Direction.UP:if(e-2<=0)continue;this.get(new c(i,e-2))!=t.CaseType.EMPTY&&(this.set(t.CaseType.EMPTY,new c(i,e-2)),this.set(t.CaseType.EMPTY,new c(i,e-1)),this.maze_recursion(e-2,i));break;case t.Direction.RIGHT:if(i+2>=this.width-1)continue;this.get(new c(i+2,e))!=t.CaseType.EMPTY&&(this.set(t.CaseType.EMPTY,new c(i+2,e)),this.set(t.CaseType.EMPTY,new c(i+1,e)),this.maze_recursion(e,i+2));break;case t.Direction.BOTTOM:if(e+2>=this.height-1)continue;this.get(new c(i,e+2))!=t.CaseType.EMPTY&&(this.set(t.CaseType.EMPTY,new c(i,e+2)),this.set(t.CaseType.EMPTY,new c(i,e+1)),this.maze_recursion(e+2,i));break;case t.Direction.LEFT:if(i-2<=0)continue;this.get(new c(i-2,e))!=t.CaseType.EMPTY&&(this.set(t.CaseType.EMPTY,new c(i-2,e)),this.set(t.CaseType.EMPTY,new c(i-1,e)),this.maze_recursion(e,i-2))}}},{key:"generateMaze",value:function(){this.mazeFirstPosition=new c(1,1,t.Direction.RIGHT),this.set(t.CaseType.EMPTY,this.mazeFirstPosition),this.maze_recursion(1,1)}},{key:"set",value:function(t,e){this.grid[e.y][e.x]=t}},{key:"get",value:function(t){return this.grid[t.y][t.x]}},{key:"valToChar",value:function(e){switch(e){case t.CaseType.EMPTY:return"-";case t.CaseType.SNAKE:return"o";case t.CaseType.SNAKE_DEAD:return"O";case t.CaseType.FRUIT:return"x";case t.CaseType.WALL:return"#";case t.CaseType.SURROUNDED:return"/";case t.CaseType.FRUIT_GOLD:return"X"}}},{key:"getImageCase",value:function(e){switch(this.get(e)){case t.CaseType.WALL:return"wall.png";case t.CaseType.FRUIT:return"fruit.png";case t.CaseType.FRUIT_GOLD:return"fruit_gold.png";case t.CaseType.EMPTY:case t.CaseType.SNAKE:case t.CaseType.SNAKE_DEAD:case t.CaseType.SURROUNDED:case t.CaseType.CROSSED:return""}return"unknown.png"}},{key:"getGraph",value:function(e){for(var i=new Array(this.height),n=0;n<this.height;n++){i[n]=new Array(this.width);for(var r=0;r<this.width;r++){var s=new c(r,n);e&&this.get(s)==t.CaseType.SNAKE?i[n][r]=0:this.isDeadPosition(s)?i[n][r]=1:i[n][r]=0}}return i}},{key:"getRandomPosition",value:function(){return new c(h.randRange(0,this.width-1,this.rngGame),h.randRange(0,this.height-1,this.rngGame))}},{key:"setFruit",value:function(e,i){var n,r,s=[1];if(i||null==this.fruitPos||this.get(this.fruitPos)!=t.CaseType.FRUIT||this.set(t.CaseType.EMPTY,this.fruitPos),!(this.getTotal(t.CaseType.EMPTY)>0))return!!(this.getTotal(t.CaseType.EMPTY)<=0&&this.fruitPosGold);do{if(n=this.getRandomPosition(),(r=this.detectCorridor(n))&&this.get(n)==t.CaseType.EMPTY&&this.set(t.CaseType.SURROUNDED,n),this.getTotal(t.CaseType.EMPTY)<=0)return!!this.fruitPosGold}while(this.get(n)!=t.CaseType.EMPTY||this.isFruitSurrounded(n,!0)||this.maze&&!this.testFruitMaze(n,s)||r);return i?(this.fruitPosGold=n,this.set(t.CaseType.FRUIT_GOLD,n)):(this.fruitPos=n,this.set(t.CaseType.FRUIT,n)),this.maze||null!=this.fruitPosGold||1!=h.randRange(1,this.probGoldFruitIncrease?3:e>1?t.Setting.PROB_GOLD_FRUIT_MULTIPLE_PLAYERS:t.Setting.PROB_GOLD_FRUIT_1_PLAYER,this.rngGame)||this.setFruit(e,!0),!0}},{key:"testFruitMaze",value:function(e,i){var n=this.getGraph(!0);return new d.Astar.Configuration(n,{order:"yx",torus:!1,diagonals:!1,cutting:!1,cost:function(t,e){return 1==e?null:1}}).path({x:this.mazeFirstPosition.x,y:this.mazeFirstPosition.y},{x:e.x,y:e.y}).length<Math.ceil(this.getTotal(t.CaseType.EMPTY)/(1*Math.ceil(i[0]/4)))?(i[0]++,!1):(i[0]++,!0)}},{key:"isCaseSurrounded",value:function(e,i,n,r){if(!e)return!1;for(var s=JSON.parse(JSON.stringify(this.grid)),o=[e];o.length>0;){var a=o[0];o.shift();for(var h=[this.getNextPosition(a,t.Direction.UP),this.getNextPosition(a,t.Direction.BOTTOM),this.getNextPosition(a,t.Direction.LEFT),this.getNextPosition(a,t.Direction.RIGHT)],c=0;c<h.length;c++)if(s[h[c].y][h[c].x]!=t.CaseType.CROSSED&&r.indexOf(this.get(h[c]))>-1){if(o.push(h[c]),n.indexOf(this.get(h[c]))>-1)return!1;i&&this.get(h[c])==t.CaseType.EMPTY?(this.set(t.CaseType.SURROUNDED,h[c]),s[h[c].y][h[c].x]=t.CaseType.SURROUNDED):s[h[c].y][h[c].x]=t.CaseType.CROSSED}}return(i&&(this.get(e)==t.CaseType.EMPTY||this.get(e)==t.CaseType.FRUIT)||this.get(e)==t.CaseType.FRUIT_GOLD)&&this.set(t.CaseType.SURROUNDED,e),!0}},{key:"isFruitSurrounded",value:function(e,i){var n=this.isCaseSurrounded(e,!1,[t.CaseType.SNAKE],[t.CaseType.EMPTY,t.CaseType.SNAKE]);return n&&i&&this.isCaseSurrounded(e,!0,[t.CaseType.SNAKE],[t.CaseType.EMPTY,t.CaseType.SNAKE]),n}},{key:"detectCorridor",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.grid?JSON.parse(JSON.stringify(this.grid)):null;if(this.maze||!e||!i)return!1;var n=this.getNextPosition(e,t.Direction.TOP),r=this.getNextPosition(e,t.Direction.BOTTOM),s=this.getNextPosition(e,t.Direction.RIGHT),o=this.getNextPosition(e,t.Direction.LEFT),a=this.isDeadPosition(n,!0,!0)+this.isDeadPosition(r,!0,!0)+this.isDeadPosition(s,!0,!0)+this.isDeadPosition(o,!0,!0);if(a<=1||this.isDeadPosition(e,!0))return!1;if(a>=3)return!0;i[e.y][e.x]=t.CaseType.CROSSED;var h=i[n.y][n.x]!=t.CaseType.CROSSED&&this.detectCorridor(n,i),c=i[r.y][r.x]!=t.CaseType.CROSSED&&this.detectCorridor(r,i),u=i[o.y][o.x]!=t.CaseType.CROSSED&&this.detectCorridor(o,i),l=i[s.y][s.x]!=t.CaseType.CROSSED&&this.detectCorridor(s,i);return!!(c||h||u||l)}},{key:"getOnLine",value:function(t,e){for(var i=0,n=0;n<this.width;n++)this.get(new c(n,e))==t&&i++;return i}},{key:"getTotal",value:function(t){for(var e=0,i=0;i<this.height;i++)e+=this.getOnLine(t,i);return e}},{key:"getNextPosition",value:function(e,i){var n=new c(e.x,e.y,i);switch(i){case t.Direction.LEFT:n.x--,n.direction=t.Direction.LEFT;break;case t.Direction.UP:n.y--,n.direction=t.Direction.UP;break;case t.Direction.RIGHT:n.x++,n.direction=t.Direction.RIGHT;break;case t.Direction.BOTTOM:n.y++,n.direction=t.Direction.BOTTOM;break;case t.Key.LEFT:n.x--,n.direction=t.Key.LEFT;break;case t.Key.UP:n.y--,n.direction=t.Key.UP;break;case t.Key.RIGHT:n.x++,n.direction=t.Direction.RIGHT;break;case t.Key.BOTTOM:n.y++,n.direction=t.Direction.BOTTOM}return n.x<0?n.x=this.width-1:n.x>=this.width&&(n.x=0),n.y<0?n.y=this.height-1:n.y>=this.height&&(n.y=0),n}},{key:"getDirectionTo",value:function(e,i){return this.getNextPosition(e,t.Direction.UP).equals(i)?t.Direction.UP:this.getNextPosition(e,t.Direction.BOTTOM).equals(i)?t.Direction.BOTTOM:this.getNextPosition(e,t.Direction.RIGHT).equals(i)?t.Direction.RIGHT:this.getNextPosition(e,t.Direction.LEFT).equals(i)?t.Direction.LEFT:-1}},{key:"invertDirection",value:function(e){return e==t.Direction.UP?t.Direction.BOTTOM:e==t.Direction.BOTTOM?t.Direction.UP:e==t.Direction.RIGHT?t.Direction.LEFT:e==t.Direction.LEFT?t.Direction.RIGHT:null}},{key:"isDeadPosition",value:function(e,i,n){return!i&&this.get(e)==t.CaseType.SNAKE||this.get(e)==t.CaseType.WALL||this.get(e)==t.CaseType.SNAKE_DEAD||!!n&&this.get(e)==t.CaseType.SURROUNDED}},{key:"toString",value:function(){for(var t="",e=0;e<this.height;e++){for(var i=0;i<this.width;i++)t+=this.valToChar(this.get(new c(i,e)))+" ";t+="\n"}return t}}])}(),f=function(){return s((function i(){e(this,i),this.aiFruitGoal=t.CaseType.FRUIT,this._aiLevelText="custom"}),[{key:"ai",value:function(e){var i=e.getHeadPosition(),n=e.grid.fruitPos,r=e.grid.fruitPosGold;if(n&&e.grid.get(n)==t.CaseType.FRUIT){var s=Math.abs(n.x-i.x)+Math.abs(n.y-i.y),o=r?Math.abs(r.x-i.x)+Math.abs(r.y-i.y):-1;r&&e.grid.get(r)==t.CaseType.FRUIT_GOLD&&this.aiFruitGoal==t.CaseType.FRUIT?this.aiFruitGoal=o<=s?t.CaseType.FRUIT_GOLD:t.CaseType.FRUIT:r&&e.grid.get(r)==t.CaseType.FRUIT_GOLD||(this.aiFruitGoal=t.CaseType.FRUIT)}else n&&e.grid.get(n)==t.CaseType.FRUIT||!r||e.grid.get(r)!=t.CaseType.FRUIT_GOLD||(this.aiFruitGoal=t.CaseType.FRUIT_GOLD);return null}},{key:"aiLevelText",get:function(){return this._aiLevelText}}])}();function g(t,e){if(e&&("object"==i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function p(t){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},p(t)}function T(){return T="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var n=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=p(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(arguments.length<3?t:i):r.value}},T.apply(null,arguments)}function v(t,e){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},v(t,e)}function x(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&v(t,e)}function k(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(k=function(){return!!t})()}var D=function(i){function n(){var t,i,r,s;return e(this,n),i=this,r=p(r=n),(t=g(i,k()?Reflect.construct(r,[],p(i).constructor):r.apply(i,s)))._aiLevelText="random",t}return x(n,i),s(n,[{key:"ai",value:function(e){var i,r;(i=this,"function"==typeof(r=T(p(n.prototype),"ai",i))?function(t){return r.apply(i,t)}:r)([e]);var s=e.getHeadPosition(),o=e.grid.isDeadPosition(e.getNextPosition(s,t.Key.UP)),a=e.grid.isDeadPosition(e.getNextPosition(s,t.Key.LEFT)),c=e.grid.isDeadPosition(e.getNextPosition(s,t.Key.BOTTOM)),u=e.grid.isDeadPosition(e.getNextPosition(s,t.Key.RIGHT));if(o&&a&&c&&u)return t.Key.UP;for(var l=null;null==l||e.grid.isDeadPosition(e.getNextPosition(s,l));)switch(h.randRange(1,4,e.grid?e.grid.rngGame:null)){case 1:l=t.Key.UP;break;case 2:l=t.Key.LEFT;break;case 3:l=t.Key.BOTTOM;break;case 4:l=t.Key.RIGHT}return l}}])}(f);function P(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(P=function(){return!!t})()}var _=function(i){function n(){var t,i,r,s;return e(this,n),i=this,r=p(r=n),(t=g(i,P()?Reflect.construct(r,[],p(i).constructor):r.apply(i,s)))._aiLevelText="low",t}return x(n,i),s(n,[{key:"ai",value:function(e){var i,r,s;if((i=n,r=this,"function"==typeof(s=T(p(1&3?i.prototype:i),"ai",r))?function(t){return s.apply(r,t)}:s)([e]),null!=e.grid.fruitPos){var o=e.getHeadPosition(),a=this.aiFruitGoal==t.CaseType.FRUIT_GOLD?e.grid.fruitPosGold:e.grid.fruitPos,h=t.Key.RIGHT;a.x>o.x?h=a.x-o.x>e.grid.width/2?t.Key.LEFT:t.Key.RIGHT:a.x<o.x?h=o.x-a.x>e.grid.width/2?t.Key.RIGHT:t.Key.LEFT:a.y<o.y?h=o.y-a.y>e.grid.height/2?t.Key.BOTTOM:t.Key.UP:a.y>o.y&&(h=a.y-o.y>e.grid.height/2?t.Key.UP:t.Key.BOTTOM);var c=e.getNextPosition(o,h);if(e.grid.isDeadPosition(c)){for(var u=this.direction,l=null,d=1;d<e.queue.length;d++)if(e.get(d).direction!=u){l=e.get(d).direction;break}c=e.getNextPosition(o,l),e.grid.isDeadPosition(c)?e.grid.isDeadPosition(e.getNextPosition(o,t.Key.UP))?e.grid.isDeadPosition(e.getNextPosition(o,t.Key.RIGHT))?e.grid.isDeadPosition(e.getNextPosition(o,t.Key.BOTTOM))?e.grid.isDeadPosition(e.getNextPosition(o,t.Key.LEFT))||(h=t.Key.LEFT):h=t.Key.BOTTOM:h=t.Key.RIGHT:h=t.Key.UP:h=c.convertToKeyDirection()}return h}}}])}(f);function E(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(E=function(){return!!t})()}var m=function(i){function n(t){var i,r,s,o;return e(this,n),r=this,s=p(s=n),(i=g(r,E()?Reflect.construct(s,[],p(r).constructor):s.apply(r,o))).enableTorus=t,i._aiLevelText="normal",i}return x(n,i),s(n,[{key:"ai",value:function(e){var i,r,s;(i=n,r=this,"function"==typeof(s=T(p(1&3?i.prototype:i),"ai",r))?function(t){return s.apply(r,t)}:s)([e]);var o=e.getHeadPosition(),a=e.grid.fruitPos,h=e.grid.fruitPosGold,u=a;if(o&&(a||h)){var l=e.grid.getGraph(!1),y=new d.Astar.Configuration(l,{order:"yx",torus:!!this.enableTorus,diagonals:!1,cutting:!1,static:!0,cost:function(t,e){return 1==e?null:1}});h&&this.aiFruitGoal==t.CaseType.FRUIT_GOLD&&(u=h);var f=y.path({x:o.x,y:o.y},{x:u?u.x:null,y:u?u.y:null});if(f.length<1&&(this.aiFruitGoal!=t.CaseType.FRUIT_GOLD&&h||(u=a),f=y.path({x:o.x,y:o.y},{x:u?u.x:null,y:u?u.y:null})),f.length>1){var g=new c(f[1].x,f[1].y);return new c(null,null,e.getDirectionTo(o,g)).convertToKeyDirection()}f=null}return null}}])}(f);function O(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(O=function(){return!!t})()}var A=function(t){function i(t){var n,r,s,o;return e(this,i),r=this,o=[!0],s=p(s=i),(n=g(r,O()?Reflect.construct(s,o||[],p(r).constructor):s.apply(r,o))).aiLow=new _(t),n._aiLevelText="high",n}return x(i,t),s(i,[{key:"ai",value:function(t){var e,n,r;return(e=i,n=this,"function"==typeof(r=T(p(1&3?e.prototype:e),"ai",n))?function(t){return r.apply(n,t)}:r)([t])||this.aiLow.ai(t)}}])}(m);function I(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(I=function(){return!!t})()}var R=function(t){function i(){var t,n,r,s;return e(this,i),n=this,r=p(r=i),(t=g(n,I()?Reflect.construct(r,[],p(n).constructor):r.apply(n,s)))._aiLevelText="mock",t}return x(i,t),s(i,[{key:"ai",value:function(){return null}}])}(f),w=function(){function i(n,r,s,o,a,h,c,u){e(this,i),this.direction=null==n?t.Direction.RIGHT:n,this.initialDirection=this.direction,this.initialLength=null==r?3:r,this.initTriedDirections=[],this.errorInit=!1,this.grid=s||new y,this.queue=[],this.lastKey=-1,this.lastTail,this.lastTailMoved,this.ticksDead=0,this.player=null==o?t.PlayerType.HUMAN:o,this.aiLevel=null==a?t.AiLevel.DEFAULT:a,this.autoRetry=null!=h&&h,this.score=0,this.gameOver=!1,this.scoreMax=!1,this.color,this.name=null==c?"Snake":c,this.snakeAI=new f,this.customAI=u,this.ticksWithoutAction=0,this.initAI()}return s(i,[{key:"init",value:function(){if(this.initialLength<=0)return this.errorInit=!0,!1;this.grid.maze&&this.initTriedDirections.length<=0&&(this.initialDirection=this.grid.mazeFirstPosition.direction,this.direction=this.initialDirection);var e=0,i=0;if(this.initialDirection==t.Direction.RIGHT&&-1==this.initTriedDirections.indexOf(t.Direction.RIGHT)||this.initialDirection==t.Direction.LEFT&&-1==this.initTriedDirections.indexOf(t.Direction.LEFT)){for(var n=0;n<this.grid.height;n++)for(var r=0,s=0;s<this.grid.width;s++)if(this.grid.get(new c(s,n))==t.CaseType.EMPTY?r++:r=0,r>=this.initialLength){e++;break}}else if(this.initialDirection==t.Direction.UP&&-1==this.initTriedDirections.indexOf(t.Direction.UP)||this.initialDirection==t.Direction.BOTTOM&&-1==this.initTriedDirections.indexOf(t.Direction.BOTTOM))for(var o=0;o<this.grid.width;o++)for(var a=0,h=0;h<this.grid.height;h++)if(this.grid.get(new c(o,h))==t.CaseType.EMPTY?a++:a=0,a>=this.initialLength){i++;break}if(this.initTriedDirections.push(this.initialDirection),e<=0&&(this.initialDirection==t.Direction.RIGHT||this.initialDirection==t.Direction.LEFT)||i<=0&&(this.initialDirection==t.Direction.UP||this.initialDirection==t.Direction.BOTTOM))return-1==this.initTriedDirections.indexOf(t.Direction.RIGHT)?(this.initialDirection=t.Direction.RIGHT,this.direction=t.Direction.RIGHT,this.init()):-1==this.initTriedDirections.indexOf(t.Direction.LEFT)?(this.initialDirection=t.Direction.LEFT,this.direction=t.Direction.LEFT,this.init()):-1==this.initTriedDirections.indexOf(t.Direction.UP)?(this.initialDirection=t.Direction.UP,this.direction=t.Direction.UP,this.init()):-1==this.initTriedDirections.indexOf(t.Direction.BOTTOM)?(this.initialDirection=t.Direction.BOTTOM,this.direction=t.Direction.BOTTOM,this.init()):(this.errorInit=!0,!1);for(var u,l,d=!0,y=[];d;){if(d=!1,!(u=this.grid.maze?this.grid.mazeFirstPosition:this.grid.getRandomPosition()))return this.errorInit=!0,!1;l=new c(u.x,u.y,this.initialDirection),y=[];for(var f=this.initialLength-1;f>=0;f--)f<this.initialLength-1&&(this.initialDirection==t.Direction.RIGHT?l=this.grid.getNextPosition(new c(l.x,l.y,this.initialDirection),t.Direction.RIGHT):this.initialDirection==t.Direction.LEFT?l=this.grid.getNextPosition(new c(l.x,l.y,this.initialDirection),t.Direction.LEFT):this.initialDirection==t.Direction.BOTTOM?l=this.grid.getNextPosition(new c(l.x,l.y,this.initialDirection),t.Direction.BOTTOM):this.initialDirection==t.Direction.UP&&(l=this.grid.getNextPosition(new c(l.x,l.y,this.initialDirection),t.Direction.UP))),this.grid.get(l)!=t.CaseType.EMPTY?d=!0:y.push(new c(l.x,l.y,l.direction));if(this.grid.maze&&d)return this.init()}var g=!1;if(!this.grid.maze){var p=new c(y[y.length-1].x,y[y.length-1].y,this.direction);(this.grid.isDeadPosition(this.grid.getNextPosition(p,t.Direction.UP),!1)&&this.direction==t.Direction.UP||this.grid.isDeadPosition(this.grid.getNextPosition(p,t.Direction.BOTTOM),!1)&&this.direction==t.Direction.BOTTOM||this.grid.isDeadPosition(this.grid.getNextPosition(p,t.Direction.LEFT),!1)&&this.direction==t.Direction.LEFT||this.grid.isDeadPosition(this.grid.getNextPosition(p,t.Direction.RIGHT),!1)&&this.direction==t.Direction.RIGHT)&&(g=!0,this.direction=this.grid.invertDirection(this.direction))}for(var T=0;T<y.length;T++)if(g){var v=y[y.length-T-1];v.direction=this.grid.invertDirection(v.direction),this.insert(y[y.length-T-1])}else this.insert(y[T]);return this.grid.maze&&this.player==t.PlayerType.HYBRID_HUMAN_AI&&(this.player=t.PlayerType.HUMAN),this.player==t.PlayerType.HYBRID_HUMAN_AI&&(this.aiLevel=t.AiLevel.HIGH),this.lastTail=this.get(this.queue.length-1),!0}},{key:"initAI",value:function(){if(this.customAI)this.snakeAI=this.customAI,this.aiLevel=t.AiLevel.CUSTOM;else switch(this.aiLevel){case t.AiLevel.RANDOM:this.snakeAI=new D;break;case t.AiLevel.LOW:this.snakeAI=new _;break;case t.AiLevel.DEFAULT:this.snakeAI=new m;break;case t.AiLevel.HIGH:case t.AiLevel.ULTRA:this.snakeAI=new A;break;case t.AiLevel.MOCK:this.snakeAI=new R;break;default:this.snakeAI=new m}}},{key:"reset",value:function(){this.direction=this.initialDirection,this.initTriedDirections=[],this.errorInit=!1,this.queue=[],this.score=0,this.gameOver=!1,this.scoreMax=!1,this.lastTailMoved=!0,this.lastTail=void 0,this.lastKey=-1,this.ticksDead=0,this.ticksWithoutAction=0,this.snakeAI&&(this.snakeAI.aiFruitGoal=t.CaseType.FRUIT)}},{key:"insert",value:function(e){this.queue.unshift(e),this.grid.set(t.CaseType.SNAKE,e)}},{key:"remove",value:function(){var e=this.queue.pop();this.grid.set(t.CaseType.EMPTY,e),this.lastTail=e}},{key:"length",value:function(){return this.queue.length}},{key:"get",value:function(t){return null!=this.queue[t]?this.queue[t].copy():null}},{key:"set",value:function(t,e){t>=0&&t<this.length()&&(this.queue[t]=e)}},{key:"getHeadPosition",value:function(){return this.get(0)}},{key:"getTailPosition",value:function(){return this.get(this.length()-1)}},{key:"hasMaxScore",value:function(){return this.grid.getTotal(t.CaseType.EMPTY)<=0&&!this.grid.fruitPosGold&&!this.grid.fruitPos}},{key:"setGameOver",value:function(e){this.gameOver=!0,this.ticksDead=e;for(var i=0;i<this.length();i++)this.grid.set(t.CaseType.SNAKE_DEAD,this.get(i))}},{key:"kill",value:function(){this.autoRetry=!1,this.grid=null,this.queue=null}},{key:"keyToDirection",value:function(e){return e==t.Key.LEFT&&this.direction!=t.Direction.RIGHT&&this.direction!=t.Direction.LEFT?t.Direction.LEFT:e==t.Key.UP&&this.direction!=t.Direction.BOTTOM&&this.direction!=t.Direction.UP?t.Direction.UP:e==t.Key.RIGHT&&this.direction!=t.Direction.LEFT&&this.direction!=t.Direction.RIGHT?t.Direction.RIGHT:e==t.Key.BOTTOM&&this.direction!=t.Direction.UP&&this.direction!=t.Direction.BOTTOM?t.Direction.BOTTOM:null}},{key:"moveTo",value:function(t){var e=this.keyToDirection(t);null!=e&&(this.direction=e)}},{key:"getNextPosition",value:function(t,e){return this.grid.getNextPosition(t,e)}},{key:"getDirectionTo",value:function(t,e){return this.grid.getDirectionTo(t,e)}},{key:"getGraphicDirectionFor",value:function(e,i,n){if(null==i||null==n)return e.direction;var r=this.getDirectionTo(e,n),s=this.getDirectionTo(e,i);return r==t.Direction.LEFT&&s==t.Direction.BOTTOM||r==t.Direction.BOTTOM&&s==t.Direction.LEFT?t.Direction.ANGLE_1:r==t.Direction.RIGHT&&s==t.Direction.BOTTOM||r==t.Direction.BOTTOM&&s==t.Direction.RIGHT?t.Direction.ANGLE_2:r==t.Direction.UP&&s==t.Direction.RIGHT||r==t.Direction.RIGHT&&s==t.Direction.UP?t.Direction.ANGLE_3:r==t.Direction.UP&&s==t.Direction.LEFT||r==t.Direction.LEFT&&s==t.Direction.UP?t.Direction.ANGLE_4:e.direction}},{key:"getGraphicDirection",value:function(t){return this.getGraphicDirectionFor(this.get(t),this.get(t-1),this.get(t+1))}},{key:"copy",value:function(){for(var t=new i(this.direction,3,new y(this.grid.width,this.grid.height,!1,!1),this.player,this.aiLevel,!1),e=0;e<t.grid.height;e++)for(var n=0;n<t.grid.width;n++)t.grid.set(this.grid.get(new c(n,e)),new c(n,e));t.queue=[];for(var r=0;r<this.queue.length;r++)t.queue.push(JSON.parse(JSON.stringify(this.queue[r])));return t}},{key:"ai",value:function(){if(this.snakeAI&&this.snakeAI.ai){var t=this.snakeAI.ai(this);return t&&this.keyToDirection(t)!=this.direction?this.ticksWithoutAction=0:this.ticksWithoutAction++,t}return null}},{key:"isAIStuck",value:function(e,i){if(this.snakeAI&&this.snakeAI.ai){if((this.direction==t.Direction.LEFT||this.direction==t.Direction.RIGHT)&&this.ticksWithoutAction>=this.grid.width*e)return!0;if((this.direction==t.Direction.UP||this.direction==t.Direction.BOTTOM)&&this.ticksWithoutAction>=this.grid.height*i)return!0}return!1}},{key:"getAILevelText",value:function(){return this.snakeAI?this.snakeAI.aiLevelText:"???"}}])}(),S=function(){return s((function t(i){e(this,t),this.games=null==i?[]:i,this.reactor=new a,this.reactor.registerEvent("onStart"),this.reactor.registerEvent("onPause"),this.reactor.registerEvent("onContinue"),this.reactor.registerEvent("onStop"),this.reactor.registerEvent("onReset"),this.reactor.registerEvent("onExit"),this.reactor.registerEvent("onScoreIncreased"),this.init()}),[{key:"init",value:function(){for(var t=this,e=0;e<this.games.length;e++)0==e&&(this.games[e].enableKeyMenu=!0),this.games[e].onPause(function(e){t.pauseAll(e)}.bind(null,e)),this.games[e].onContinue(function(e){t.startAll(e)}.bind(null,e)),this.games[e].onExit(function(e){t.checkExit(e)}.bind(null,e)),this.games[e].onStop(function(e){t.checkStop(e)}.bind(null,e)),this.games[e].onReset(function(e){t.resetAll(e)}.bind(null,e)),this.games[e].onScoreIncreased(function(e){t.checkOnScoreIncreased(e)}.bind(null,e))}},{key:"start",value:function(){this.startAll(null)}},{key:"startAll",value:function(t){for(var e=0;e<this.games.length;e++)!this.games[e].paused||this.games[e].starting||null!=t&&e==t||this.games[e].start();this.reactor.dispatchEvent("onStart")}},{key:"onStart",value:function(t){this.reactor.addEventListener("onStart",t)}},{key:"pauseAll",value:function(t){for(var e=0;e<this.games.length;e++)this.games[e].paused||null!=t&&e==t||this.games[e].pause();this.reactor.dispatchEvent("onPause")}},{key:"onPause",value:function(t){this.reactor.addEventListener("onPause",t)}},{key:"resetAll",value:function(t){for(var e=0;e<this.games.length;e++)this.games[e].isReseted||null!=t&&e==t||this.games[e].reset();this.reactor.dispatchEvent("onReset")}},{key:"onReset",value:function(t){this.reactor.addEventListener("onReset",t)}},{key:"checkExit",value:function(t){for(var e=!0,i=0;i<this.games.length;i++)this.games[i].exited||(e=!1);e?this.reactor.dispatchEvent("onExit"):this.startAll(t)}},{key:"onExit",value:function(t){this.reactor.addEventListener("onExit",t)}},{key:"checkStop",value:function(){for(var t=!0,e=0;e<this.games.length;e++)this.games[e].gameOver||(t=!1);t&&this.reactor.dispatchEvent("onStop")}},{key:"onStop",value:function(t){this.reactor.addEventListener("onStop",t)}},{key:"stopAll",value:function(t){for(var e=0;e<this.games.length;e++)t?this.games[e].finish(!0):this.games[e].stop()}},{key:"killAll",value:function(){for(var t=0;t<this.games.length;t++)this.games[t].kill()}},{key:"checkOnScoreIncreased",value:function(){this.reactor.dispatchEvent("onScoreIncreased")}},{key:"onScoreIncreased",value:function(t){this.reactor.addEventListener("onScoreIncreased",t)}},{key:"setDisplayFPS",value:function(t){for(var e=0;e<this.games.length;e++)this.games[e].setDisplayFPS(t)}},{key:"setNotification",value:function(t){for(var e=0;e<this.games.length;e++)this.games[e].setNotification(t.copy())}},{key:"closeNotification",value:function(){for(var t=0;t<this.games.length;t++)this.games[t].setNotification(null)}},{key:"errorOccurred",value:function(){for(var t=0;t<this.games.length;t++)if(this.games[t].errorOccurred)return!0;return!1}},{key:"closeRanking",value:function(){for(var t=0;t<this.games.length;t++)this.games[t].closeRanking();return!1}},{key:"destroySnakes",value:function(t,e){for(var i=0;i<this.games.length;i++)if(this.games[i].destroySnakes(t,e),t&&Array.isArray(t))for(var n=0;n<t.length;n++)t[n]-=1}},{key:"getWinners",value:function(){for(var t=[],e=[],i=-1,n=0;n<this.games.length;n++)for(var r=0;r<this.games[n].snakes.length;r++)this.games[n].snakes[r].score>i&&(i=this.games[n].snakes[r].score);if(i>=0)for(var s=0,o=0;o<this.games.length;o++)for(var a=0;a<this.games[o].snakes.length;a++)this.games[o].snakes[a].score>=i&&(t.push(this.games[o].snakes[a]),e.push(s)),s++;return{winners:t,score:i,index:e}}}])}(),b=function(){return s((function t(i,n,r,s,o,h,c){e(this,t),this.grid=i,this.snakes=n,this.speed=null==r?8:r,this.initialSpeed=null==r?8:r,this.initialSpeedUntouched=null==r?8:r,this.enablePause=null==s||s,this.enableRetry=null==o||o,this.progressiveSpeed=null!=h&&h,this.aiStuckLimit=null==c?3:c,this.countBeforePlay=3,this.lastKey=-1,this.numFruit=1,this.ticks=0,this.firstStart=!0,this.starting=!1,this.paused=!0,this.exited=!1,this.killed=!1,this.isReseted=!0,this.gameOver=!1,this.gameFinished=!1,this.gameMazeWin=!1,this.scoreMax=!1,this.errorOccurred=!1,this.clientSidePredictionsMode=!1,this.aiStuck=!1,this.intervalPlay,this.reactor=new a,this.reactor.registerEvent("onStart"),this.reactor.registerEvent("onPause"),this.reactor.registerEvent("onContinue"),this.reactor.registerEvent("onReset"),this.reactor.registerEvent("onStop"),this.reactor.registerEvent("onExit"),this.reactor.registerEvent("onKill"),this.reactor.registerEvent("onScoreIncreased"),this.reactor.registerEvent("onUpdate"),this.reactor.registerEvent("onUpdateCounter")}),[{key:"init",value:function(){if(!this.clientSidePredictionsMode)if(null==this.snakes?(this.errorOccurred=!0,this.snakes=[]):Array.isArray(this.snakes)?(Array.isArray(this.snakes)&&this.snakes.length<=0||this.grid.maze&&this.snakes.length>1)&&(this.errorOccurred=!0):this.snakes=[this.snakes],this.grid instanceof y==0)this.errorOccurred=!0;else if(!this.errorOccurred){this.initGridAndSnakes();for(var t=h.randRange(0,360,this.grid?new(l())(this.grid.seedGame):null),e=0;e<this.snakes.length;e++)this.snakes[e]instanceof w==0?this.errorOccurred=!0:(t=h.addHue(t,Math.round(360/this.snakes.length)),this.snakes[e].color=t)}}},{key:"initGridAndSnakes",value:function(){if(this.grid.reset(),this.grid.init(),null!=this.snakes){for(var t=0;t<this.snakes.length;t++)this.snakes[t].reset();for(var e=0;e<this.snakes.length;e++)this.snakes[e].init()}this.grid.setFruit(this.snakes.length)}},{key:"reset",value:function(){this.paused=!0,this.isReseted=!0,this.exited=!1,this.clearIntervalPlay(),this.numFruit=1,this.ticks=0,this.lastKey=-1,this.scoreMax=!1,this.errorOccurred=!1,this.gameOver=!1,this.gameFinished=!1,this.gameMazeWin=!1,this.starting=!1,this.initialSpeed=this.initialSpeedUntouched,this.speed=this.initialSpeedUntouched,this.aiStuck=!1,this.grid.seedGrid&&(this.grid.seedGrid=""+(parseInt(this.grid.seedGrid)+1)),this.grid.seedGame&&(this.grid.seedGame=""+(parseInt(this.grid.seedGame)+1)),this.initGridAndSnakes(),this.reactor.dispatchEvent("onReset"),this.start()}},{key:"start",value:function(){var t=this;if(this.reactor.dispatchEvent("onUpdateCounter"),!this.errorOccurred){if(null!=this.snakes)for(var e=0;e<this.snakes.length;e++)this.snakes[e].errorInit&&(this.errorOccurred=!0,this.stop());!this.paused||this.gameOver||this.killed||this.scoreMax||this.starting||(this.starting=!0,this.firstStart||this.reactor.dispatchEvent("onContinue"),this.countBeforePlay=3,this.clearIntervalPlay(),this.reactor.dispatchEvent("onUpdateCounter"),this.intervalPlay=setInterval((function(){t.countBeforePlay--,t.reactor.dispatchEvent("onUpdateCounter"),t.countBeforePlay<0&&t.forceStart()}),1e3))}}},{key:"forceStart",value:function(){this.clearIntervalPlay(),this.countBeforePlay=-1,this.paused=!1,this.isReseted=!1,this.firstStart=!1,this.starting=!1,this.reactor.dispatchEvent("onStart"),this.tick()}},{key:"clearIntervalPlay",value:function(){clearInterval(this.intervalPlay)}},{key:"continue",value:function(){this.clientSidePredictionsMode||(this.start(),this.reactor.dispatchEvent("onContinue"))}},{key:"stop",value:function(t){this.gameOver||this.clientSidePredictionsMode||(this.paused=!0,this.gameOver=!0,t&&(this.gameFinished=!0),this.clearIntervalPlay(),this.reactor.dispatchEvent("onStop"))}},{key:"pause",value:function(){this.paused||this.clientSidePredictionsMode||(this.paused=!0,this.clearIntervalPlay(),this.reactor.dispatchEvent("onPause"))}},{key:"kill",value:function(){if(!this.killed){if(this.paused=!0,this.gameOver=!0,this.killed=!0,null!=this.snakes)for(var t=0;t<this.snakes.length;t++)this.snakes[t].kill(),this.snakes[t]=null;this.clearIntervalPlay(),this.grid=null,this.snakes=null,this.reactor.dispatchEvent("onKill")}}},{key:"exit",value:function(){this.exited||(this.stop(),this.exited=!0,this.reactor.dispatchEvent("onExit"))}},{key:"destroySnakes",value:function(t,e){for(var i=0;i<this.snakes.length;i++)t&&Array.isArray(t)&&t.indexOf(i)<0&&e.indexOf(this.snakes[i].player)>-1&&this.snakes[i].setGameOver(this.ticks)}},{key:"getNBPlayer",value:function(t){var e=0;if(null!=this.snakes)for(var i=0;i<this.snakes.length;i++)this.snakes[i].player==t&&e++;return e}},{key:"getPlayer",value:function(t,e){var i=0;if(null!=this.snakes)for(var n=0;n<this.snakes.length;n++)if(this.snakes[n].player==e&&i++,i==t)return this.snakes[n];return null}},{key:"tick",value:function(){var e=this;setTimeout((function(){e.doTick()}),this.initialSpeed*t.Setting.TIME_MULTIPLIER)}},{key:"doTick",value:function(){if(!this.paused&&!this.killed){this.ticks++;var e,i=!1;if(this.grid&&(!this.grid.maze||this.grid.mazeForceAuto||this.grid.maze&&this.getNBPlayer(t.PlayerType.HUMAN)<=0&&this.getNBPlayer(t.PlayerType.HYBRID_HUMAN_AI)<=0||this.grid.maze&&(this.getNBPlayer(t.PlayerType.HUMAN)>0||this.getNBPlayer(t.PlayerType.HYBRID_HUMAN_AI)>0)&&-1!=(this.getPlayer(1,t.PlayerType.HYBRID_HUMAN_AI)||this.getPlayer(1,t.PlayerType.HUMAN)).lastKey)){for(var n=0;n<this.snakes.length;n++){var r=this.snakes[n].direction,s=!1,o=!1;if(i=!1,this.snakes[n].lastTailMoved=!1,!this.snakes[n].gameOver&&!this.snakes[n].scoreMax){this.snakes[n].player==t.PlayerType.HUMAN||this.snakes[n].player==t.PlayerType.HYBRID_HUMAN_AI?(this.snakes[n].moveTo(this.snakes[n].lastKey),this.snakes[n].lastKey=-1):this.snakes[n].player==t.PlayerType.AI&&(!this.clientSidePredictionsMode||this.clientSidePredictionsMode&&this.snakes[n].aiLevel!=t.AiLevel.RANDOM)&&this.snakes[n].moveTo(this.snakes[n].ai());var a=this.snakes[n].getHeadPosition();this.snakes[n].player==t.PlayerType.HYBRID_HUMAN_AI&&this.grid.isDeadPosition(this.snakes[n].getNextPosition(a,this.snakes[n].direction))&&(this.snakes[n].direction=r,this.snakes[n].moveTo(this.snakes[n].ai()),this.snakes[n].lastKey=-1),a=this.snakes[n].getNextPosition(a,this.snakes[n].direction),this.grid.isDeadPosition(a)?this.snakes[n].setGameOver(this.ticks):this.grid.get(a)==t.CaseType.FRUIT||this.grid.get(a)==t.CaseType.FRUIT_GOLD?(this.grid.get(a)==t.CaseType.FRUIT?(this.snakes[n].score++,this.grid.set(t.CaseType.EMPTY,this.grid.fruitPos),this.grid.fruitPos=null):this.grid.get(a)==t.CaseType.FRUIT_GOLD&&(this.snakes[n].score+=3,this.grid.set(t.CaseType.EMPTY,this.grid.fruitPosGold),this.grid.fruitPosGold=null,o=!0),e=!0,this.snakes[n].insert(a),this.grid.maze?(this.gameMazeWin=!0,this.gameFinished=!0,this.stop()):this.snakes[n].hasMaxScore()&&this.snakes.length<=1?(this.scoreMax=!0,this.snakes[n].scoreMax=!0,this.stop()):(this.numFruit++,o||(s=!0)),this.snakes.length<=1&&this.progressiveSpeed&&this.snakes[n].score>0&&this.initialSpeed>1&&(this.initialSpeed=Math.ceil(-this.initialSpeedUntouched/100*this.snakes[n].score+this.initialSpeedUntouched),this.initialSpeed=this.initialSpeed<1?1:this.initialSpeed)):(this.snakes[n].insert(a),this.grid.maze||(this.snakes[n].remove(),this.snakes[n].lastTailMoved=!0))}this.scoreMax||!s||this.clientSidePredictionsMode||(i=!this.grid.setFruit(this.snakes.length))}this.scoreMax||i||!this.grid.detectCorridor(this.grid.fruitPos)&&!this.grid.isFruitSurrounded(this.grid.fruitPos,!0)||this.clientSidePredictionsMode||(i=!this.grid.setFruit(this.snakes.length)),this.scoreMax||null==this.grid.fruitPosGold||!this.grid.detectCorridor(this.grid.fruitPosGold)&&!this.grid.isFruitSurrounded(this.grid.fruitPosGold,!0)||(this.grid.set(t.CaseType.EMPTY,this.grid.fruitPosGold),this.grid.fruitPosGold=null);for(var h=0,c=0;c<this.snakes.length;c++)(this.snakes[c].gameOver||this.snakes[c].scoreMax)&&h++;for(var u=!1,l=0;l<this.snakes.length;l++)if(!this.snakes[l].gameOver&&this.snakes[l].isAIStuck(1,1))this.aiStuck=!0,u=!!this.snakes[l].isAIStuck(this.aiStuckLimit,this.aiStuckLimit);else if((this.snakes[l].player==t.PlayerType.HUMAN||this.snakes[l].player==t.PlayerType.HYBRID_HUMAN_AI)&&!this.snakes[l].gameOver||this.snakes[l].player==t.PlayerType.AI&&!this.snakes[l].gameOver){this.aiStuck=!1,u=!1;break}(h>=this.snakes.length||i||u)&&(this.stop(),this.snakes.length>1&&(this.gameFinished=!0)),this.reactor.dispatchEvent("onUpdate"),e&&this.reactor.dispatchEvent("onScoreIncreased")}this.tick()}}},{key:"onReset",value:function(t){this.reactor.addEventListener("onReset",t)}},{key:"onStart",value:function(t){this.reactor.addEventListener("onStart",t)}},{key:"onContinue",value:function(t){this.reactor.addEventListener("onContinue",t)}},{key:"onStop",value:function(t){this.reactor.addEventListener("onStop",t)}},{key:"onPause",value:function(t){this.reactor.addEventListener("onPause",t)}},{key:"onExit",value:function(t){this.reactor.addEventListener("onExit",t)}},{key:"onKill",value:function(t){this.reactor.addEventListener("onKill",t)}},{key:"onScoreIncreased",value:function(t){this.reactor.addEventListener("onScoreIncreased",t)}},{key:"onUpdate",value:function(t){this.reactor.addEventListener("onUpdate",t)}},{key:"onUpdateCounter",value:function(t){this.reactor.addEventListener("onUpdateCounter",t)}}])}()})(),__webpack_exports__})()));